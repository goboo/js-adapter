/*
 * GoBoo - GET IT. BOOK IT. [http://goboo.de]
 *
 * (c) Tristan Lins <t.lins@goboo.de>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

var goboo=goboo||{};window.goboo=goboo;goboo.env={};goboo.env.adapter=null;goboo.init=function(a){var b={host:"demo.goboo.io"};for(var c in (a||{})){b[c]=a[c]}goboo.env.adapter=new goboo.Adapter(b)};
goboo.Adapter=function(a){var b={host:"demo.goboo.de",path:""};for(var c in (a||{})){b[c]=a[c]}var d="http://"+b.host+b.path+"/api/v3/";this.listSlots=function(g,k,i,j){var f=[];if(k){f.push("from="+encodeURIComponent(k.toW3CString()))}if(i){f.push("until="+encodeURIComponent(i.toW3CString()))}var h="";if(f.length){h="?"+f.join("&")}var e=new XMLHttpRequest();e.open("GET",d+"rest/room/"+g+"/slots"+h,true);e.onreadystatechange=function(){if(e.readyState!=4){return}var m;if(e.status!=200){m=false}else{m=JSON.parse(e.responseText)}var n=[];if(m){for(var l in m.slots){var o=m.slots[l];var p=new goboo.Slot();p.setId(o.id);p.setRoomId(g);p.setStartDateTime(new Date(o.startDateTime));p.setDuration(o.duration);p.setPlayTime(o.playTime);p.setCapacity(o.capacity);p.setAttendance(o.attendance);p.setPlayers(o.players);p.setLocked(o.locked);n.push(p)}}j(n)};e.send()};this.listSlotPredecessors=function(i,e,h){var g=e?("?limit="+e):"";var f=new XMLHttpRequest();f.open("GET",d+"rest/room/"+i.getRoomId()+"/slot/"+i.getId()+"/predecessors"+g,true);f.onreadystatechange=function(){if(f.readyState!=4){return}var k;if(f.status!=200){k=false}else{k=JSON.parse(f.responseText)}var l=[];if(k){for(var j in k){var m=k[j];var n=new goboo.Slot();n.setId(m.id);n.setRoomId(roomId);n.setStartDateTime(new Date(m.startDateTime));n.setDuration(m.duration);n.setPlayTime(m.playTime);n.setCapacity(m.capacity);n.setAttendance(m.attendance);n.setPlayers(m.players);n.setLocked(m.locked);l.push(n)}}h(l)};f.send()};this.listSlotSuccessors=function(i,e,h){var g=e?("?limit="+e):"";var f=new XMLHttpRequest();f.open("GET",d+"rest/room/"+i.getRoomId()+"/slot/"+i.getId()+"/successors"+g,true);f.onreadystatechange=function(){if(f.readyState!=4){return}var k;if(f.status!=200){k=false}else{k=JSON.parse(f.responseText)}var l=[];if(k){for(var j in k){var m=k[j];var n=new goboo.Slot();n.setId(m.id);n.setRoomId(m.room);n.setStartDateTime(new Date(m.startDateTime));n.setDuration(m.duration);n.setPlayTime(m.playTime);n.setCapacity(m.capacity);n.setAttendance(m.attendance);n.setPlayers(m.players);n.setLocked(m.locked);l.push(n)}}h(l)};f.send()};this.getSlot=function(g,e,h){var f=new XMLHttpRequest();f.open("GET",d+"rest/room/"+g+"/slot/"+e,true);f.onreadystatechange=function(){if(f.readyState!=4){return}var j;if(f.status!=200){j=false}else{j=JSON.parse(f.responseText)}var m=null;if(j){m=new goboo.Slot();m.setId(j.id);m.setRoomId(j.room);m.setStartDateTime(new Date(j.startDateTime));m.setDuration(j.duration);m.setPlayTime(j.playTime);m.setCapacity(j.capacity);m.setAttendance(j.attendance);m.setPlayers(j.players);m.setLocked(j.locked);var k=[];for(var i in j.availableModes){var l=new goboo.Mode();l.setToken(modeData.token);l.setLabel(modeData.label);l.setDescription(modeData.description);l.setMinAttendance(modeData.minAttendance);l.setMaxAttendance(modeData.maxAttendance);l.setVotes(modeData.votes);k.push(l)}m.setAvailableModes(k)}h(m)};f.send()};this.bookSlot=function(o,f,h){var j=o.getSlots();var g=null;var n={};var m=[];for(var i in j){var l=j[i];g=l.getRoomId();n[g]=true;m.push(l.getId())}if(n.length>1){throw"A booking can only contain slots from the same room."}else{if(n.length<1){return}}var k={name:o.getName(),mobile:o.getMobile(),email:o.getEmail(),attendance:o.getAttendance(),players:o.getPlayers(),exclusive:o.isExclusive(),preferredModes:o.getPreferredModes(),notes:o.getNotes(),slots:m};var e=new XMLHttpRequest();e.open("POST",d+"rest/room/"+g+"/book",true);e.setRequestHeader("Content-type","application/json");e.onreadystatechange=function(){if(e.readyState!=4){return}var p;try{p=JSON.parse(e.responseText)}catch(q){p=false}var r=null;if(!p){h(false,e)}else{if(p.error){h(p.error.message,e)}else{if(e.status!=200){h(false,e)}else{f(p,e)}}}};e.send(JSON.stringify(k))}};
goboo.Booking=function(){var a;var b;var g;var f;var h;var d;var c;var i;var e;this.getName=function(){return a};this.setName=function(j){a=j};this.getMobile=function(){return b};this.setMobile=function(j){b=j};this.getEmail=function(){return g};this.setEmail=function(j){g=j};this.getSlots=function(){return f};this.setSlots=function(j){f=j};this.getAttendance=function(){return h};this.setAttendance=function(j){h=j};this.getPlayers=function(){return d};this.setPlayers=function(j){d=j};this.isExclusive=function(){return c};this.setExclusive=function(j){c=j};this.getPreferredModes=function(){return i};this.setPreferredModes=function(j){i=j};this.getNotes=function(){return e};this.setNotes=function(j){e=j}};
goboo.Mode=function(){var b;var a;var c;var f;var e;var d;this.getToken=function(){return b};this.setToken=function(g){b=g};this.getLabel=function(){return a};this.setLabel=function(g){a=g};this.getDescription=function(){return c};this.setDescription=function(g){c=g};this.getMinAttendance=function(){return f};this.setMinAttendance=function(g){f=g!==null?parseInt(g):null};this.getMaxAttendance=function(){return e};this.setMaxAttendance=function(g){e=g!==null?parseInt(g):null};this.getVotes=function(){return d};this.setVotes=function(g){d=parseInt(g)}};
goboo.Slot=function(){var c=-1;var e=-1;var k=new Date();var j=null;var f=-1;var d=null;var a=-1;var g=false;var h=-1;var b=[];var i=[];this.getId=function(){return c};this.setId=function(l){c=l};this.getRoomId=function(){return e};this.setRoomId=function(l){e=l};this.getStartDateTime=function(){return k};this.setStartDateTime=function(l){k=l};this.getEndDateTime=function(){if(j){return j}var l=new Date(k);l.setSeconds(l.getSeconds()+(f*60));return l};this.setEndDateTime=function(l){j=l};this.getDuration=function(){return f};this.setDuration=function(l){f=parseInt(l)};this.getPlayTime=function(){return d};this.setPlayTime=function(l){d=parseInt(l)};this.getCapacity=function(){return a};this.setCapacity=function(l){a=parseInt(l)};this.isLocked=function(){return g};this.setLocked=function(l){g=l?true:false};this.getAttendance=function(){return h};this.setAttendance=function(l){h=l!==null?parseInt(l):null};this.getPlayers=function(){return b};this.setPlayers=function(l){b=l?l:[]};this.getAvailableModes=function(){return i};this.setAvailableModes=function(l){i=l?l:[]}};